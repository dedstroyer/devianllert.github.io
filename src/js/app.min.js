'use strict';

const animatePlace = document.querySelector('.animation-place');

function animateSlide() {
  // Анимация для проектов...

  console.log(animatePlace.children);

}

function menuSlide() {

  const menuItem = document.createElement('li');
  menuItem.className = 'apps-count_list-item';



}

function animate() {

}



















// Выполнение функции один раз.
function once(fn, context) { 
  var result;

  return function() { 
      if(fn) {
          result = fn.apply(context || this, arguments);
          fn = null;
      }

      return result;
  };
}

// Пример использования
var canOnlyFireOnce = once(function() {
  console.log('Запущено!');
});

canOnlyFireOnce(); // "Запущено!"
canOnlyFireOnce(); // Не запущено
;(function () {
  window.addEventListener('load', preloader);

  function preloader() {
    const loader = document.querySelector('.preloader');
    setTimeout(function () {
      loader.style.opacity = 0;
      setTimeout(function () {
        loader.remove();
      }, 500) // после изменения прозрачности, через 0.5 секунд удялаем прелоадер со страницы
    }, 2500)
  }
})();

;(function() {

  document.addEventListener('DOMContentLoaded', createTimer);

  function createTimer() {
    const clock = document.createElement('div'),
          date = document.createElement('div'),
          time = document.createElement('div');

    clock.className = 'clock';
    date.className = 'clock-date';
    time.className = 'clock-time';

    clock.appendChild(time);
    clock.appendChild(date);
    
    document.body.appendChild(clock);

    function setClock() {
      let timeNow = new Date();
      let clock = {
        day: timeNow.getDate(),
        month: timeNow.getMonth() + 1, // Добавляем 1 потому что нумерация начинается с 0.
        year: timeNow.getFullYear(),
        second: timeNow.getSeconds(),
        minute: timeNow.getMinutes(),
        hour: timeNow.getHours(),
        update: function () {
          timeNow = new Date();
          this.day = timeNow.getDate();
          this.month = timeNow.getMonth() + 1; // Добавляем 1 потому что нумерация начинается с 0.
          this.year = timeNow.getFullYear();
          this.second = timeNow.getSeconds();
          this.minute = timeNow.getMinutes();
          this.hour = timeNow.getHours();
        }
      };

      setInterval(function () {
        clock.update();
        if (clock.second < 10) {
          clock.second = '0' + clock.second;
        }
        if (clock.minute < 10) {
          clock.minute = '0' + clock.minute;
        }
        if (clock.hour < 10) {
          clock.hour = '0' + clock.hour;
        }
        if (clock.day < 10) {
          clock.day = '0' + clock.day;
        }
        if (clock.month < 10) {
          clock.month = '0' + clock.month;
        }
        date.textContent = `${clock.day}.${clock.month}.${clock.year}`;
        time.textContent = `${clock.hour}:${clock.minute}:${clock.second}`;
      }, 1000);

    }

    setClock();

  }
})();
;
const atomic = (document => {

    const atomicTextInput = document.querySelector('.atomic-text_input'), // поле ввода
        atomicTextView = document.querySelector('.atomic-text_view'); // поле вывода

    function liveReloadText() {

        function truncate(str) {
            let maxlength = 20;
            return str.slice(0, (maxlength)) + '...';
        }

        atomicTextView.textContent = atomicTextInput.value;

    }

    function init() {
        atomicTextInput.addEventListener('input', liveReloadText);
    }

    return init;

})(document);

atomic();
;
const todo = (document => {

    'use strict';

    // ===== imperative style code =====

    const todoView = document.querySelector('.todo-list_view');
    const todoInput = document.querySelector('.todo-list_input');
    const todoButton = document.querySelector('.todo-list_add-item');
    const todoItems = document.querySelectorAll('.todo-list_item');

    function createElement(tag, props, ...children) { // ...children оператор оставшихся параметров
        const element = document.createElement(tag);

        Object.keys(props).forEach(key => element[key] = props[key]); // !! Разобрать все методы в этой строке

        children.forEach(child => {
            if (typeof child === 'string') {
                child = document.createTextNode(child);
            }
            element.appendChild(child);
        })

        return element;
    }

    function createTodoItem(title) {
        const checkbox = createElement('input', {
            type: 'checkbox',
            className: 'todo-list_checkbox',
            id: 'task' + (todoView.children.length + 1)
        });
        // checkbox.id = todoItem.children + 1 + ''; // now label not work!!

        const labelText = createElement('span', {
            className: 'todo-list_label-title'
        }, title)

        const label = createElement('label', {
            className: 'todo-list_label',
        }, labelText);
        label.setAttribute('for','task' + (todoView.children.length + 1))

        const checkboxTitle = createElement('div', {
            className: 'todo-list_checkbox-title'
        }, checkbox, label);

        const editInput = createElement('input', {
            type: 'text',
            className: 'todo-list_edit-input'
        });

        const editButton = createElement('button', {
            className: 'todo-list_edit-btn'
        });

        const deleteButton = createElement('button', {
            className: 'todo-list_delete-btn'
        });

        const editTodo = createElement('div', {
            className: 'todo-list_edit'
        }, editButton, deleteButton);

        const todoItem = createElement('li', {
            className: 'todo-list_item'
        }, checkboxTitle, editInput, editTodo);

        bindEvents(todoItem);

        return todoItem;

    }

    function bindEvents(todoItem) {
        const checkbox = todoItem.querySelector('.todo-list_checkbox');
        const editButton = todoItem.querySelector('.todo-list_edit-btn');
        const deleteButton = todoItem.querySelector('.todo-list_delete-btn');

        // проверка id для уже существующих элементов
        for (let i = 0; i < todoView.children.length; i++) {
            todoView.children[i].querySelector('.todo-list_checkbox').id = 'task' + (i + 1);
            todoView.children[i].querySelector('.todo-list_label').setAttribute('for','task' + (i + 1))
        }
        
        checkbox.addEventListener('change', toggleTodo);
        editButton.addEventListener('click', editTodo);
        deleteButton.addEventListener('click', deleteTodo);
    }

    function addTodo(event) {
        event.preventDefault(); // for button.type = 'submit'

        // const limit = 10;
        const listItem = createTodoItem(todoInput.value);
        const titles = document.querySelectorAll('.todo-list_label-title');
        // const todoItems = document.querySelectorAll('.todo-list_item');

        if (todoInput.value === '') {
            return alert('Введите название задачи!');
        }

        // if (todoItems.length >= limit) {
        //     alert(`Вы не можете создать больше ${limit} задач`);
        //     return false;
        // }

        for (let i = 0; i < titles.length; i++) {
            if (todoInput.value == titles[i].textContent) {
                alert ('Такая задача уже есть!');
                return false;
            }
        }

        todoView.appendChild(listItem);

        todoInput.value = '';

    }

    function toggleTodo() {
        const todoItem = this.parentNode.parentNode;
        todoItem.classList.toggle('completed');
    }

    function editTodo() {
        const todoItem = this.parentNode.parentNode;
        const title = todoItem.querySelector('.todo-list_label-title');
        const editInput = todoItem.querySelector('.todo-list_edit-input');
        const isEditing = todoItem.classList.contains('editing');
        const titles = document.querySelectorAll('.todo-list_label-title');

        if (isEditing) {
            if (editInput.value == '') {
                alert('Поле не может быть пустым!');
                return false;
            }

            for (let i = 0; i < titles.length; i++) {
                if (editInput.value == titles[i].textContent) {
                    alert ('Такая задача уже есть!');
                    return false;
                }
            }

            title.textContent = editInput.value;
        } else {
            editInput.value = title.textContent;
        }

        todoItem.classList.toggle('editing');
    }

    function deleteTodo() {
        const todoItem = this.parentNode.parentNode;
        
        todoItem.remove();

        for (let i = 0; i < todoView.children.length; i++) {
            todoView.children[i].querySelector('.todo-list_checkbox').id = 'task' + (i + 1);
            todoView.children[i].querySelector('.todo-list_label').setAttribute('for','task' + (i + 1))
        }

    }

    function init() {
        todoButton.addEventListener('click', addTodo);
        todoItems.forEach(item => bindEvents(item));

        // window.onbeforeunload = function() {
        //     return "Данные не сохранены. Точно перейти?";
        //   };
    
    }

    return init;

})(document);

todo()

